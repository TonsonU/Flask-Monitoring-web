{% extends "dashboard/dashboard.html" %}

{% block dashboard_content %}


<div id="location-dashboard" class="container-fluid">
    <div class="row mb-4">
        <div class="d-flex justify-content-between align-items-center flex-wrap">
            <h2 class="fw-bold mb-3 me-3">Equipment Overview</h2>
        
            <!-- Toggle ‡∏õ‡∏£‡∏±‡∏ö theme -->
            <label class="switch mb-3">
                <input type="checkbox" id="toggleDarkMode">
                <span class="slider">
                  <i id="themeIcon" class="fas fa-moon"></i> <!-- ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡πÄ‡∏õ‡πá‡∏ô Moon -->
                </span>
              </label>
              
        </div>
              
        

        <!-- üìå Dropdown Filter -->
        <div class="col-12 mb-4">
            <label for="equipmentFilter" class="form-label fw-semibold">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå: </label>
            <select id="equipmentFilter" class="form-select custom-dropdown w-auto d-inline-block">
                <option value="">-- ‡∏ó‡∏∏‡∏Å‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó --</option>
            </select>
        </div>

        <!-- ‚úÖ Charts Section -->
        <div class="row g-4">

            <!-- Pie: ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏á‡∏≤‡∏ô CM -->
            <div class="col-lg-6 col-md-12">
                <div class="card shadow-sm rounded-4 text-center h-100">
                    <div class="card-body">
                        <h5 class="card-title fw-bold">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏á‡∏≤‡∏ô CM</h5>
                        <canvas id="work-count-by-equipment-chart" style="max-height: 300px;"></canvas>
                    </div>
                </div>
            </div>

            <!-- Pie: ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ -->
            <div class="col-lg-6 col-md-12">
                <div class="card shadow-sm rounded-4 text-center h-100">
                    <div class="card-body">
                        <h5 class="card-title fw-bold">‡∏™‡∏±‡∏î‡∏™‡πà‡∏ß‡∏ô‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏á‡∏≤‡∏ô‡∏ã‡πà‡∏≠‡∏° (Open / Closed)</h5>
                        <canvas id="status-pie-chart" style="max-height: 300px;"></canvas>
                    </div>
                </div>
            </div>

            <!-- Line: ‡∏£‡∏≤‡∏¢‡∏õ‡∏µ -->
            <div class="col-lg-6 col-md-12">
                <div class="card shadow-sm rounded-4 text-center h-100">
                    <div class="card-body">
                        <h5 class="card-title fw-bold">‡πÅ‡∏ô‡∏ß‡πÇ‡∏ô‡πâ‡∏°‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏Ç‡∏≠‡∏á‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå (‡∏õ‡∏µ)</h5>
                        <canvas id="work-trend-line-chart" style="max-height: 300px;"></canvas>
                    </div>
                </div>
            </div>

            <!-- Line: ‡∏£‡∏≤‡∏¢‡πÄ‡∏î‡∏∑‡∏≠‡∏ô -->
            <div class="col-lg-6 col-md-12">
                <div class="card shadow-sm rounded-4 text-center position-relative h-100">
                    <div class="card-body pt-4">
                        <h5 class="card-title fw-bold mb-3">‡πÅ‡∏ô‡∏ß‡πÇ‡∏ô‡πâ‡∏°‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏Ç‡∏≠‡∏á‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå (‡πÄ‡∏î‡∏∑‡∏≠‡∏ô)</h5>
                        <!-- üìå Dropdown ‡∏õ‡∏µ (‡∏≠‡∏¢‡∏π‡πà‡∏Ç‡∏ß‡∏≤‡∏ö‡∏ô) -->
                        <select id="monthYearSelect"
                                class="form-select form-select-sm position-absolute"
                                style="top: 1rem; right: 1rem; width: auto; max-width: 150px;">
                        </select>
                        <canvas id="monthly-trend-line-chart" style="max-height: 285px;"></canvas>
                    </div>
                </div>
            </div>

            <!-- Bar: Location Breakdown -->
            <div class="col-lg-6 col-md-12">
                <div class="card shadow-sm rounded-4 text-center h-100">
                    <div class="card-body">
                        <h5 class="card-title fw-bold">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏á‡∏≤‡∏ô CM ‡πÅ‡∏ï‡πà‡∏•‡∏∞ Location</h5>
                        <canvas id="device-location-breakdown-chart" style="max-height: 300px;"></canvas>
                    </div>
                </div>
            </div>

            <!-- Bar: Device Breakdown -->
            <div class="col-lg-6 col-md-12">
                <div class="card shadow-sm rounded-4 text-center h-100">
                    <div class="card-body">
                        <h5 class="card-title fw-bold">‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡∏¥‡∏î‡πÄ‡∏Ñ‡∏™‡∏ö‡πà‡∏≠‡∏¢‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î</h5>
                        <canvas id="breakdown-equipment-chart" style="max-height: 300px;"></canvas>
                    </div>
                </div>
            </div>

            <!-- Point Case Chart -->
            <div id="point-card" class="col-lg-6 col-md-12" style="display: none;">
                <div class="card shadow-sm rounded-4 text-center h-100">
                    <div class="card-body">
                        <h5 class="card-title fw-bold">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏™‡∏≤‡πÄ‡∏´‡∏ï‡∏∏‡πÄ‡∏Ñ‡∏™ CM ‡∏Ç‡∏≠‡∏á Point</h5>
                        <canvas id="point-case-chart" style="max-height: 300px;"></canvas>
                    </div>
                </div>
            </div>

            <!-- Cause Case Chart -->
            <div id="cause-card" class="col-lg-6 col-md-12" style="display: none;">
                <div class="card shadow-sm rounded-4 text-center h-100">
                    <div class="card-body">
                        <h5 class="card-title fw-bold">‡πÄ‡∏Ñ‡∏™ CM ‡∏Ç‡∏≠‡∏á Point ‡πÄ‡∏Å‡∏¥‡∏î‡∏à‡∏≤‡∏Å</h5>
                        <canvas id="cause-case-chart" style="max-height: 300px;"></canvas>
                    </div>
                </div>
            </div>

        </div>
    </div>
</div>

<script src="{{ url_for('static', filename='equipment_dashboard.js') }}"></script>
<script>
    document.addEventListener("DOMContentLoaded", function () {
      const toggle = document.getElementById("toggleDarkMode");
    
      // ‡πÇ‡∏´‡∏•‡∏î‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ dark mode ‡∏ñ‡πâ‡∏≤‡∏°‡∏µ
      if (localStorage.getItem("dark-mode") === "enabled") {
        document.body.classList.add("dark-mode");
        toggle.checked = true;
      }
    
      toggle.addEventListener("change", function () {
        document.body.classList.toggle("dark-mode");
        if (this.checked) {
          localStorage.setItem("dark-mode", "enabled");
        } else {
          localStorage.setItem("dark-mode", "disabled");
        }
      });
    });
</script>
    
    

<style>
    .card {
        transition: transform 0.2s ease-in-out;
    }
    .card:hover {
        transform: translateY(-4px);
    }

    .form-select.custom-dropdown {
        min-width: 220px;
    }

    canvas {
        width: 100% !important;
        height: auto !important;
    }

    /* ‚úÖ ‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö Toggle */
    .switch {
    position: relative;
    display: inline-block;
    width: 50px;
    height: 26px;
    }

    .switch input {
        opacity: 0;
        width: 0;
        height: 0;
    }

    .slider {
        position: absolute;
        cursor: pointer;
        inset: 0;
        background-color: #ccc;
        border-radius: 30px;
        transition: background-color 0.3s;
    }

    .slider:before {
        content: "";
        position: absolute;
        height: 22px;
        width: 22px;
        left: 2px;
        top: 2px;
        background-color: white;
        border-radius: 50%;
        transition: transform 0.3s ease;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.4);
    }

    .switch input:checked + .slider {
        background-color: #333;
    }

    .switch input:checked + .slider:before {
        transform: translateX(24px);
    }

    /* ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÑ‡∏≠‡∏Ñ‡∏≠‡∏ô‡∏û‡∏£‡∏∞‡∏à‡∏±‡∏ô‡∏ó‡∏£‡πå‡∏ï‡∏£‡∏á‡∏Å‡∏•‡∏≤‡∏á */
    .slider i {
        position: absolute;
        left: 12px;
        top: 6px;
        font-size: 14px;
        color: #fff;
        pointer-events: none;
    }

    /* üåô Dark Mode Styling */
    body.dark-mode {
    background-color: #121212;
    color: #e0e0e0;
    }

    body.dark-mode .card {
    background-color: #1e1e1e;
    color: #fff;
    border: 1px solid #333;
    }

    body.dark-mode .card .card-title {
    color: #ffffff;
    }

    body.dark-mode .form-select,
    body.dark-mode .custom-dropdown {
    background-color: #2b2b2b;
    color: #fff;
    border: 1px solid #444;
    }

    body.dark-mode canvas {
    background-color: transparent !important;
    }
</style>

{% endblock %}
