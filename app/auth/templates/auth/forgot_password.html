<!--
####################################################
# Flask Monitoring Web
#
#
# Project : Python, Flask, MySQLite, Bootstrap
# Author  : Tonson Ubonsri
# Modifier:
# Version :
# Date    : Dec 01, 2024
#
####################################################
-->

{% extends "layout.html" %}

{# --- CSS อยู่ใน block head ถูกต้อง --- #}
{% block head %}
    {{ super() }}
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
{% endblock head %}


{% block content %}
<div class="container d-flex justify-content-center align-items-center" style="height: 100vh;">
    <div class="card shadow p-4 custom-card">
        <h3 class="text-center forgot-password-text mb-4 ">Forgot Password</h3>
        <form method="POST" novalidate>
            {{ form.hidden_tag() }}
            <!-- Username -->
            <div class="form-floating mb-3">
                {{ form.username(class="form-control custom-input" + (" is-invalid" if form.username.errors else ""), placeholder=" ", required=True) }}
                {{ form.username.label }}
                {# --- แสดง error จาก form validation เท่านั้น --- #}
                {% if form.username.errors %}
                    <div class="invalid-feedback">
                        {{ form.username.errors[0] }} {# แสดง error แรกที่เจอ #}
                    </div>
                {% endif %}
            </div>

            <!-- Password -->
            <div class="form-floating mb-3 position-relative">
                {{ form.new_password(id="new_password", class="form-control custom-input" + (" is-invalid" if form.new_password.errors else ""), placeholder=" ", required=True) }}
                {{ form.new_password.label }}
                <button type="button" class="btn btn-eye position-absolute" onclick="togglePasswordVisibility()" aria-label="Toggle password visibility">
                    {# --- แก้ไข: เอา comment ออกเพื่อให้ไอคอนแสดง --- #}
                    <i class="fas fa-eye" id="eye-icon"></i>
                </button>
                {% if form.new_password.errors %}
                    <div class="invalid-feedback">
                        {{ form.new_password.errors[0] }}
                    </div>
                {% endif %}
            </div>

            {# --- ใช้ WTForms render submit button ถูกต้อง --- #}
            {{ form.submit(class="btn btn-primary w-80 py-2 d-block mx-auto custom-button") }}

        </form>

        {# --- แก้ไข: ลบบล็อก if not user_found ออกทั้งหมด --- #}
        {# {% if not user_found and request.method == 'POST' %}
        <div class="alert alert-danger mt-3 text-center">
            User not found. <a href="{{ url_for('auth.register') }}" class="text-decoration-none">Register here</a>.
        </div>
        {% endif %} #}
        {# --- สิ้นสุดการลบ --- #}

        <div class="mt-3 text-center">
            <a href="{{ url_for('auth.login') }}" class="text-decoration-none">Back to Login</a>
        </div>
    </div>
</div>
{% endblock content %}


{# --- JavaScript อยู่ใน block scripts ถูกต้อง --- #}
{% block scripts %}
    {{ super() }}
    <script>
        function togglePasswordVisibility() {
            const passwordField = document.getElementById("new_password");
            const eyeIcon = document.getElementById("eye-icon"); // ตรวจสอบว่า id นี้ถูกใช้ใน <i> tag ด้านบน
            if (!eyeIcon) return; // เพิ่มการตรวจสอบเผื่อ eyeIcon ไม่มี

            if (passwordField.type === "password") {
                passwordField.type = "text";
                eyeIcon.classList.remove("fa-eye");
                eyeIcon.classList.add("fa-eye-slash");
            } else {
                passwordField.type = "password";
                eyeIcon.classList.remove("fa-eye-slash");
                eyeIcon.classList.add("fa-eye");
            }
        }
    </script>
{% endblock scripts %}
