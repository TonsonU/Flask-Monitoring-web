<!--
####################################################
# Flask Monitoring Web
#
# 
# Project : Python, Flask, MySQLite, Bootstrap
# Author  : Thanapoom Sukarin
# Modifier: 
# Version : 
# Date    : Dec 01, 2024
#
####################################################
-->

{% import "bootstrap/wtf.html" as wtf %}
{% extends "layout.html" %}

{% block content %}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Interlocking Report Form</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
</head>
<body>
<div class="container py-4">
    <h2>TAP Report Form</h2>
    <form method="POST" action="{{ url_for('report.generate_tap_pdf') }}">
        <label>Date:</label><input type="text" name="date"><br>
        <label>Work Order No:</label><input type="text" name="work_order"><br>
        <label>Work Type :</label><input type="text" name="work_type"><br>
        <label>Location:</label><input type="text" name="loation"><br>
        <label>Track Possession No:</label><input type="text" name="track_no"><br>
        <label>Apostle Name:</label>
        <select name="apostle" id="apostle_select">
            <option value="">-- ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å --</option>
        </select><br>
    
        <!-- ‚úÖ ‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô Unit ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà -->
        <label>‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô Unit ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà:</label>
        <select id="change_unit" name="change_unit" onchange="toggleUnitSection()">
            <option value="no">‡πÑ‡∏°‡πà‡∏°‡∏µ</option>
            <option value="yes">‡∏°‡∏µ</option>
        </select><br>
    
        <!-- ‚úÖ ‡∏ñ‡πâ‡∏≤‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô ‡πÉ‡∏´‡πâ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏à‡∏≥‡∏ô‡∏ß‡∏ô -->
        <div id="unit_count_section" style="display: none;">
            <label>‡∏°‡∏µ‡∏Å‡∏µ‡πà‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô:</label>
            <select id="unit_count" onchange="toggleUnitFields()">
                <option value="1">1 ‡∏ä‡∏¥‡πâ‡∏ô</option>
                <option value="2">2 ‡∏ä‡∏¥‡πâ‡∏ô</option>
                <option value="3">3 ‡∏ä‡∏¥‡πâ‡∏ô</option>
            </select><br>
        </div>
    
        <!-- ‚úÖ ‡∏Å‡∏•‡∏∏‡πà‡∏° Unit ‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏ã‡πà‡∏≠‡∏ô‡πÑ‡∏î‡πâ -->
        <div id="unit_fields">
            <div id="unit_1" style="display:none;">
                <label>Unit No.1:</label><input type="text" name="unit_name_1"><br>
                <label>Serial Installed No.1:</label><input type="text" name="sn_installed_1"><br>
                <label>Serial Removed No.1:</label><input type="text" name="sn_removed_1"><br>
                <label>Qty No.1:</label><input type="text" name="qty_1"><br>
            </div>
            <div id="unit_2" style="display:none;">
                <label>Unit No.2:</label><input type="text" name="unit_name_2"><br>
                <label>Serial Installed No.2:</label><input type="text" name="sn_installed_2"><br>
                <label>Serial Removed No.2:</label><input type="text" name="sn_removed_2"><br>
                <label>Qty No.2:</label><input type="text" name="qty_2"><br>
            </div>
            <div id="unit_3" style="display:none;">
                <label>Unit No.3:</label><input type="text" name="unit_name_3"><br>
                <label>Serial Installed No.3:</label><input type="text" name="sn_installed_3"><br>
                <label>Serial Removed No.3:</label><input type="text" name="sn_removed_3"><br>
                <label>Qty No.3:</label><input type="text" name="qty_3"><br>
            </div>
        </div>
    
        <hr>
        <label>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ú‡∏π‡πâ‡∏õ‡∏è‡∏¥‡∏ö‡∏±‡∏ï‡∏¥‡∏á‡∏≤‡∏ô:</label>
    <select id="person_count" onchange="togglePersonFields()">
        <option value="1">1 ‡∏Ñ‡∏ô</option>
        <option value="2">2 ‡∏Ñ‡∏ô</option>
        <option value="3">3 ‡∏Ñ‡∏ô</option>
        <option value="4">4 ‡∏Ñ‡∏ô</option>
        <option value="5">5 ‡∏Ñ‡∏ô</option>
        <option value="6">6 ‡∏Ñ‡∏ô</option>
        <option value="7">7 ‡∏Ñ‡∏ô</option>
        <option value="8">8 ‡∏Ñ‡∏ô</option>
        <option value="9">9 ‡∏Ñ‡∏ô</option>
        <option value="10">10 ‡∏Ñ‡∏ô</option>
    </select><br><br>

    <!-- ‚úÖ ‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏õ‡∏è‡∏¥‡∏ö‡∏±‡∏ï‡∏¥‡∏á‡∏≤‡∏ô -->
    <div id="person_fields">
        <!-- ‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏î‡πâ‡∏ß‡∏¢ JavaScript -->
    </div>
    
        <label>Maintenance Action:</label><input type="text" name="maintenance_action"><br>
    
        <button type="submit">‡∏™‡∏£‡πâ‡∏≤‡∏á PDF</button>
    </form>
    <script>
        const people = [
          "‡∏ô‡∏≤‡∏¢‡∏Å‡∏¥‡∏ï‡∏ï‡∏¥‡∏Ñ‡∏∏‡∏ì ‡∏ß‡∏±‡∏í‡∏ô‡∏≤‡∏ô‡∏±‡∏ô‡∏ó‡πå",
          "‡∏ô‡∏≤‡∏¢‡∏ä‡∏±‡∏ä‡∏ß‡∏≤‡∏• ‡∏ò‡∏£‡∏£‡∏°‡∏™‡∏≠‡∏ô",
          "‡∏ô‡∏≤‡∏¢‡∏™‡∏°‡∏ä‡∏≤‡∏¢ ‡πÄ‡∏Ç‡πá‡∏°‡∏ó‡∏≠‡∏á",
          "‡∏ô‡∏≤‡∏á‡∏™‡∏≤‡∏ß‡∏õ‡∏¥‡∏¢‡∏∞‡∏ô‡∏∏‡∏ä ‡∏Ñ‡∏≥‡∏†‡∏≤",
          "‡∏ô‡∏≤‡∏á‡∏™‡∏≤‡∏ß‡∏≠‡∏£‡∏ß‡∏£‡∏£‡∏ì ‡∏û‡∏∂‡πà‡∏á‡∏ö‡∏∏‡∏ç",
          "‡∏ô‡∏≤‡∏¢‡∏ò‡∏ô‡∏û‡∏• ‡πÉ‡∏à‡∏î‡∏µ",
          "‡∏ô‡∏≤‡∏¢‡∏à‡∏¥‡∏£‡∏≤‡∏¢‡∏∏‡∏ó‡∏ò ‡∏ô‡∏≤‡∏Ñ‡∏î‡∏µ",
          "‡∏ô‡∏≤‡∏á‡∏™‡∏≤‡∏ß‡∏ä‡∏ô‡∏¥‡∏Å‡∏≤‡∏ô‡∏ï‡πå ‡∏õ‡∏£‡∏µ‡∏î‡∏≤",
          "‡∏ô‡∏≤‡∏¢‡∏≠‡∏†‡∏¥‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå ‡∏ô‡∏≤‡∏ß‡∏≤‡∏£‡∏±‡∏ï‡∏ô‡πå",
          "‡∏ô‡∏≤‡∏á‡∏™‡∏∏‡∏£‡∏µ‡∏¢‡πå‡∏û‡∏£ ‡∏û‡∏¥‡∏°‡∏û‡πå‡πÑ‡∏ó‡∏¢"
        ];
      
        function populateApostleDropdown() {
          const apostleSelect = document.getElementById("apostle_select");
          if (!apostleSelect) return;
          apostleSelect.innerHTML = '<option value="">-- ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å --</option>';
          for (const name of people) {
            const option = document.createElement("option");
            option.value = name;
            option.textContent = name;
            apostleSelect.appendChild(option);
          }
        }
      
        function toggleUnitSection() {
          const changeUnit = document.getElementById('change_unit').value;
          const unitCountSection = document.getElementById('unit_count_section');
          if (changeUnit === 'yes') {
            unitCountSection.style.display = 'block';
            toggleUnitFields();
          } else {
            unitCountSection.style.display = 'none';
            for (let i = 1; i <= 3; i++) {
              document.getElementById('unit_' + i).style.display = 'none';
              document.querySelector(`[name="unit_name_${i}"]`).value = '-';
              document.querySelector(`[name="sn_installed_${i}"]`).value = '-';
              document.querySelector(`[name="sn_removed_${i}"]`).value = '-';
              document.querySelector(`[name="qty_${i}"]`).value = '-';
            }
          }
        }
      
        function toggleUnitFields() {
          const count = parseInt(document.getElementById('unit_count').value);
          for (let i = 1; i <= 3; i++) {
            const section = document.getElementById('unit_' + i);
            if (i <= count) {
              section.style.display = 'block';
              document.querySelector(`[name="unit_name_${i}"]`).value = '';
              document.querySelector(`[name="sn_installed_${i}"]`).value = '';
              document.querySelector(`[name="sn_removed_${i}"]`).value = '';
              document.querySelector(`[name="qty_${i}"]`).value = '';
            } else {
              section.style.display = 'none';
              document.querySelector(`[name="unit_name_${i}"]`).value = '-';
              document.querySelector(`[name="sn_installed_${i}"]`).value = '-';
              document.querySelector(`[name="sn_removed_${i}"]`).value = '-';
              document.querySelector(`[name="qty_${i}"]`).value = '-';
            }
          }
        }
      
        function togglePersonFields() {
          const count = parseInt(document.getElementById('person_count').value);
          for (let i = 1; i <= 10; i++) {
            const field = document.getElementById('person_' + i);
            if (i <= count) {
              field.style.display = 'block';
            } else {
              field.style.display = 'none';
              const select = document.querySelector(`[name="person_${i}"]`);
              if (select) select.value = '';
            }
          }
          updateAllDropdowns();
        }
      
        function getSelectedValues() {
          const values = [];
          for (let i = 1; i <= 10; i++) {
            const select = document.querySelector(`[name="person_${i}"]`);
            if (select && select.value) {
              values.push(select.value);
            }
          }
          return values;
        }
      
        function generateOptions(selectedValue) {
          let options = '<option value="">-- ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å --</option>';
          for (const name of people) {
            const isSelected = name === selectedValue ? " selected" : "";
            options += `<option value="${name}"${isSelected}>${name}</option>`;
          }
          return options;
        }
      
        function updateAllDropdowns() {
          const selected = getSelectedValues();
          for (let i = 1; i <= 10; i++) {
            const select = document.querySelector(`[name="person_${i}"]`);
            if (!select || select.closest("div").style.display === "none") continue;
            const currentValue = select.value;
            select.innerHTML = '<option value="">-- ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å --</option>';
            for (const name of people) {
              if (selected.includes(name) && name !== currentValue) continue;
              const option = document.createElement("option");
              option.value = name;
              option.text = name;
              if (name === currentValue) option.selected = true;
              select.appendChild(option);
            }
          }
        }
      
        document.addEventListener("DOMContentLoaded", function () {
          const container = document.getElementById("person_fields");
          for (let i = 1; i <= 10; i++) {
            const div = document.createElement("div");
            div.id = "person_" + i;
            div.style.display = i === 1 ? "block" : "none";
      
            const label = document.createElement("label");
            label.textContent = `Person No.${i}:`;
      
            const select = document.createElement("select");
            select.name = `person_${i}`;
            select.dataset.index = i;
            select.innerHTML = generateOptions("");
            select.addEventListener("change", updateAllDropdowns);
      
            div.appendChild(label);
            div.appendChild(select);
            div.appendChild(document.createElement("br"));
            container.appendChild(div);
          }
      
          // üîÅ ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡πÉ‡∏ä‡πâ‡∏ï‡∏≠‡∏ô‡πÇ‡∏´‡∏•‡∏î‡∏´‡∏ô‡πâ‡∏≤
          populateApostleDropdown();
          toggleUnitSection();
          togglePersonFields();
        });
      </script>

{% endblock %}